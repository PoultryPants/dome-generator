(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=r(t);fetch(t.href,n)}})();const Q=[[[[!0,!0],[!0,!0]],[[!0,!0],[!0,!0]]],[[[!0,!1],[!0,!1]],[[!0,!1],[!0,!1]]],[[[!1,!0],[!1,!0]],[[!1,!0],[!1,!0]]],[[[!0,!0],[!0,!1]],[[!0,!0],[!0,!1]]],[[[!0,!0],[!0,!0]],[[!0,!1],[!0,!1]]],[[[!0,!1],[!0,!0]],[[!0,!1],[!0,!0]]],[[[!0,!1],[!0,!1]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!1,!0]],[[!0,!0],[!1,!0]]],[[[!0,!0],[!0,!0]],[[!1,!0],[!1,!0]]],[[[!1,!0],[!0,!0]],[[!1,!0],[!0,!0]]],[[[!0,!0],[!1,!0]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!0,!1]],[[!0,!1],[!0,!1]]],[[[!0,!1],[!0,!0]],[[!0,!1],[!0,!1]]],[[[!0,!1],[!0,!1]],[[!0,!1],[!0,!0]]],[[[!0,!1],[!0,!1]],[[!0,!0],[!0,!1]]],[[[!0,!0],[!1,!0]],[[!1,!0],[!1,!0]]],[[[!1,!0],[!1,!0]],[[!0,!0],[!1,!0]]],[[[!1,!0],[!0,!0]],[[!1,!0],[!1,!0]]],[[[!1,!0],[!1,!0]],[[!1,!0],[!0,!0]]],[[[!0,!1],[!0,!0]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!0,!0]],[[!0,!1],[!0,!0]]],[[[!0,!0],[!0,!1]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!0,!0]],[[!0,!0],[!0,!1]]],[[[!1,!0],[!0,!0]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!0,!0]],[[!1,!0],[!0,!0]]],[[[!0,!0],[!1,!0]],[[!0,!0],[!0,!0]]],[[[!0,!0],[!0,!0]],[[!0,!0],[!1,!0]]]];function D(e,s,r){if(s===0)return e[r];if(s===1)return e.map(o=>o[r]);if(s===2)return e.map(o=>o.map(t=>t[r]));throw new Error("Invalid axis: "+s+". Axis must be 0, 1, or 2.")}const W=Math.sqrt(3)/2;function T(e){const[s,r]=e[0],[o,t]=e[1];var n=[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5]];s||(n[0]=[.5,.5]),o||(n[2]=[.5,.5]),r||(n[6]=[.5,.5]),t||(n[4]=[.5,.5]),!o&&!s&&(n[1]=[.5,.5]),!t&&!o&&(n[3]=[.5,.5]),!r&&!t&&(n[5]=[.5,.5]),!s&&!r&&(n[7]=[.5,.5]);var l=[n[0]];for(let f=1;f<n.length;f++)n[f]!==n[f-1]&&l.push(n[f]);return n}function le(e){var s=[];for(let l=2;l>=0;l--){var r=D(e,l,0),o=D(e,l,1);r=[[r[0][0]&&!o[0][0],r[0][1]&&!o[0][1]],[r[1][0]&&!o[1][0],r[1][1]&&!o[1][1]]];var t=T(r),n=[];for(let f=0;f<t.length;f++){const[d,w]=t[f];l===0?n.push([.5,d,w]):l===1?n.push([d,.5,w]):l===2&&n.push([d,w,.5])}s.push({contour:n,axis:l})}for(let l=0;l<3;l++){var r=D(e,l,1),t=T(r),n=[];for(let v=0;v<t.length;v++){const[I,a]=t[v];l===0?n.push([1,I,a]):l===1?n.push([I,1,a]):l===2&&n.push([I,a,1])}s.push({contour:n,axis:l})}return s.map(l=>({contour:ie(l.contour),axis:l.axis}))}function ue(e){const[s,r,o]=e,t=(s-r)*W,n=(s+r-2*o)*.5;return[t,n]}function ie(e){return e.map(s=>ue(s))}class te{context;size;ratio;origin;blocks;colors;constructor(s,r,o,t){this.context=s,this.size=r;let n=r[2]+(r[0]+r[1])*.5,l=(r[0]+r[1])*W;this.ratio=2*Math.min(this.context.canvas.clientHeight/n,this.context.canvas.clientWidth/l),this.origin=[this.context.canvas.clientWidth/2,this.context.canvas.clientHeight/4],this.blocks=o,this.colors=t,o.sort((f,d)=>f[1][0]+f[1][1]+f[1][2]-d[1][0]-d[1][1]-d[1][2])}_render_block(s,r){const o=le(s);for(const t of o){this.context.beginPath();const n=[this.origin[0]+(r[0]-r[1])*W*this.ratio,this.origin[1]+(-2*r[2]+r[0]+r[1])*.5*this.ratio];this.context.moveTo(t.contour[0][0]*this.ratio+n[0],t.contour[0][1]*this.ratio+n[1]);for(let l=1;l<t.contour.length;l++)this.context.lineTo(t.contour[l][0]*this.ratio+n[0],t.contour[l][1]*this.ratio+n[1]);this.context.fillStyle=this.colors[t.axis],this.context.fill(),this.context.closePath(),this.context.stroke()}}render(s){this.context.clearRect(0,0,this.context.canvas.clientWidth,this.context.canvas.clientHeight);for(const r of this.blocks)r[1][2]<s&&this._render_block(r[0],r[1])}}const R=[{values:[[1,1],[1,1]],name:"Full",id:0},{values:[[0,0],[0,0]],name:"Empty",id:-1},{values:[[.5,.5],[.5,.5]],name:"Slab",id:1},{values:[[.5,.5],[1,1]],name:"Stair1",id:6},{values:[[.5,1],[.5,1]],name:"Stair2",id:5},{values:[[1,1],[.5,.5]],name:"Stair3",id:4},{values:[[1,.5],[1,.5]],name:"Stair4",id:3},{values:[[.5,.5],[.5,1]],name:"OuterCornerStair1",id:13},{values:[[.5,.5],[1,.5]],name:"OuterCornerStair2",id:14},{values:[[1,.5],[.5,.5]],name:"OuterCornerStair3",id:11},{values:[[.5,1],[.5,.5]],name:"OuterCornerStair4",id:12},{values:[[.5,1],[1,1]],name:"InnerCornerStair1",id:19},{values:[[1,1],[.5,1]],name:"InnerCornerStair2",id:20},{values:[[1,1],[1,.5]],name:"InnerCornerStair3",id:22},{values:[[1,.5],[1,1]],name:"InnerCornerStair4",id:21}],ce=R.slice(0,7);function X(e,s){const r=e.flat().map(d=>d/2),o=Math.floor(Math.min(...r));if(r.filter(d=>d===0).length>=2)return{lift:0,selectedId:-1};const t=r.map(d=>d-o);let n=1/0,l=-1;const f=s?R:ce;for(const d of f){const w=d.values.flat();let v=0;for(let I=0;I<4;I++){const a=w[I]-t[I];v+=a*a}v<n&&(n=v,l=d.id)}return{lift:o,selectedId:l}}function H(e,s,r){const o=2*s,t=2*r;return[[e[o][t],e[o][t+1]],[e[o+1][t],e[o+1][t+1]]]}function q(e,s,r="sphere",o=0,t=!1){const n=2*e,l=[],f=o/100;let d=1;r==="oblate"&&f>0?d=Math.sqrt(1-f*f):r==="prolate"&&f>0&&(d=1/Math.sqrt(1-f*f));for(let a=0;a<n;a++){const g=[];for(let h=0;h<n;h++){const u=a+.5-e,i=h+.5-e,c=Math.sqrt(Math.max(e*e-u*u-i*i,0))*d;g.push(c)}l.push(g)}const w=typeof s=="string"?s:s?"all":"none",v=[];for(let a=0;a<e;a++){const g=[];for(let h=0;h<e;h++){const u=w==="all"||w==="legal",{lift:i,selectedId:c}=X(H(l,a,h),u);g.push({lift:i,selectedId:c})}v.push(g)}if(w==="legal"){const a=new Set([11,12,13,14,19,20,21,22]),g=new Set([3,4,5,6,11,12,13,14,19,20,21,22]),h=new Map;for(let u=0;u<e;u++)for(let i=0;i<e;i++){const{lift:c,selectedId:y}=v[u][i];for(let E=0;E<c;E++)h.set(`${u},${i},${E}`,0);y>=0&&h.set(`${u},${i},${c}`,y)}for(let u=0;u<e;u++)for(let i=0;i<e;i++){const c=v[u][i];if(!a.has(c.selectedId))continue;const y=c.lift,E=[[u-1,i],[u+1,i],[u,i-1],[u,i+1]];let P=!1;for(const[$,O]of E){if($<0||O<0||$>=e||O>=e)continue;const A=`${$},${O},${y}`,F=h.get(A);if(F!==void 0&&g.has(F)){P=!0;break}}if(!P){const $=X(H(l,u,i),!1);v[u][i]={lift:c.lift,selectedId:$.selectedId},$.selectedId>=0?h.set(`${u},${i},${y}`,$.selectedId):h.delete(`${u},${i},${y}`)}}}if(t){const a=new Set([3,4,5,6]),g=R.find(c=>c.id===0),h=R.find(c=>c.id===1),u=[];for(let c=0;c<e;c++)u.push([c,c]),u.push([c,e-1-c]);const i=new Set;for(const[c,y]of u){const E=`${c},${y}`;if(i.has(E)||(i.add(E),c<0||y<0||c>=e||y>=e))continue;const P=v[c][y];if(!a.has(P.selectedId))continue;const O=H(l,c,y).flat().map(b=>b/2),A=Math.floor(Math.min(...O)),F=O.map(b=>b-A),ne=g.values.flat(),se=h.values.flat();let G=0,K=0;for(let b=0;b<4;b++){const U=ne[b]-F[b],J=se[b]-F[b];G+=U*U,K+=J*J}const oe=G<=K?0:1;v[c][y].selectedId=oe}}const I=[];for(let a=0;a<e;a++)for(let g=0;g<e;g++){const{lift:h,selectedId:u}=v[a][g];for(let i=0;i<h;i++)I.push([Q[0],[a,g,i]]);u>=0&&I.push([Q[u],[a,g,h]])}return I}let C=document.querySelector("#canvas");if(!C)throw new Error("Canvas element not found");const V=C.getContext("2d");if(!V)throw new Error("Cannot build context");const Y=document.getElementById("slider-radius"),ae=document.getElementById("label-radius"),k=document.getElementById("slider-cut"),N=document.getElementById("label-cut"),Z=document.getElementById("slider-eccentricity"),fe=document.getElementById("label-eccentricity"),ee=document.getElementById("spheroid-type"),B=document.getElementById("corner-use"),L=document.getElementById("ensure-symmetry"),re=document.getElementById("eccentricity-group");var _=[],p=13,m=7,S=0,j=new te(V,[0,0,0],[],["#933DF0","#5F0EB5","#C392F7"]);let x="sphere";function z(e,s,r){const o=Math.min(r/100,.999);let t;return s==="sphere"?t=e:s==="oblate"?t=e*Math.sqrt(1-o*o):t=e/Math.sqrt(1-o*o),Math.floor(t/2)}function de(e,s,r){const o=Math.min(r/100,.999);return s==="sphere"?e:s==="oblate"?e*Math.sqrt(1-o*o):e/Math.sqrt(1-o*o)}function M(){if(!C)throw new Error("Canvas element not found");if(!V)throw new Error("Cannot build context");const e=de(p,x,S);j=new te(V,[p*2,p*2,Math.ceil(e)],_,["#933DF0","#5F0EB5","#C392F7"]);const s=Math.max(0,e-p);s>0&&(j.origin[1]+=s/3.14*j.ratio),j.render(m=m)}Y.addEventListener("input",()=>{p=Number(Y.value),m=z(p,x,S),k.max=String(m),k.value=String(m),N.textContent=`Cut: ${m}`,ae.textContent=`Diameter: ${p}`,_=q(p,B.value,x,S,L?.checked),M()});k.addEventListener("input",()=>{m=Number(k.value),N.textContent=`Cut: ${m}`,j.render(m=m)});Z.addEventListener("input",()=>{S=Number(Z.value),fe.textContent=`Eccentricity: ${(S/100).toFixed(2)}`,m=z(p,x,S),k.max=String(m),k.value=String(m),N.textContent=`Cut: ${m}`,_=q(p,B.value,x,S,L?.checked),M()});ee.addEventListener("change",()=>{x=ee.value,re.style.display=x==="sphere"?"none":"flex",m=z(p,x,S),k.max=String(m),k.value=String(m),N.textContent=`Cut: ${m}`,_=q(p,B.value,x,S,L?.checked),M()});B.addEventListener("change",()=>{_=q(p,B.value,x,S,L?.checked),M()});L?.addEventListener("change",()=>{_=q(p,B.value,x,S,L.checked),M()});window.addEventListener("load",()=>{const e=C.getBoundingClientRect();C.width=e.width,C.height=e.height-100,re.style.display=x==="sphere"?"none":"flex",M()});window.addEventListener("resize",()=>{const e=C.getBoundingClientRect();C.width=e.width,C.height=e.height-100,M()});_=q(p,B.value,x,S,L?.checked);M();
